#!/bin/bash

# SETTINGS
REPO_URL="https://github.com/deybydjimenez/dotfiles.git"

# -------------------------------------------------------------------------- 
# ------------------------------ DO NOT TOUCH ------------------------------
# --------------------------------------------------------------------------

CONFIG_DIR="$HOME/.config/dotfiles"
DOTFILES_DIR="$HOME/.dotfiles"
IS_FIRST_RUN="$CONFIG_DIR/.dotfiles_run"

# check if git is installed
if ! dpkg -s git >/dev/null 2>&1; then
	echo "Installing Git"
	sudo apt install git
fi

# check if ansible is installed
if ! dpkg -s ansible >/dev/null 2>&1; then
	echo "Installing Ansible"
	sudo apt install software-properties-common
	sudo apt-add-repository --yes --update ppa:ansible/ansible
	sudo apt install ansible -y
fi

# Clone repository
if ! [[ -d "$DOTFILES_DIR" ]]; then
    echo "Cloning repository:"
    git clone --quiet "$REPO_URL" "$DOTFILES_DIR" 2>&1 > /dev/null
else
    echo "Updating repository"
    git -C "$DOTFILES_DIR" pull --quiet > /dev/null
fi

ansible-playbook ../main.yml --ask-vault-pass --ask-become-pass